<!DOCTYPE html>
<html>

<head>

  <title>Eck</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <style>
/* CSS стили для всплывающих меню языка */
/* Добавьте эти стили в секцию <style> в head или в отдельный CSS файл */

  .langPopup {
  display: none;
  position: absolute;
  top: 65px;
  right: 10px;
  background-color: rgba(255, 255, 255, 0.95);
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  padding: 15px;
  width: 320px;
  font-family: "Comic Sans MS", sans-serif;
  filter: brightness(100%);
  transition: all 0.3s ease;
}

.langPopupHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding-bottom: 10px;
}

.langPopupHeader h3 {
  margin: 0;
  font-size: 18px;
  color: rgba(0, 0, 0, 0.7);
}

.langPopupClose {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: rgba(0, 0, 0, 0.5);
  transition: color 0.3s;
}

.langPopupClose:hover {
  color: rgba(0, 0, 0, 0.8);
}

.langGrid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.langButton {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 5px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
}

.langButton:hover {
  background-color: rgba(180, 180, 180, 0.2);
  transform: translateY(-2px);
}

.langButton svg {
  margin-bottom: 5px;
  filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.2));
}

.langButton span {
  font-size: 12px;
  text-align: center;
  color: rgba(0, 0, 0, 0.7);
}

/* Стили для активной кнопки в меню выбора языка */
.langButton.active {
  background-color: rgba(180, 180, 180, 0.4);
}

/* Анимация появления меню */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.langPopup.visible {
  display: block;
  animation: fadeIn 0.3s ease;
}

/* Адаптация для мобильных устройств */
@media (max-width: 768px) {
  .langPopup {
    width: 280px;
    right: 5px;
  }
  
  .langGrid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Специальные стили для RTL языков */
html[dir="rtl"] .langPopup {
  right: auto;
  left: 10px;
}




    /*
    @font-face {
      font-family: 'Comic Sans MS';
      src: url("comici.ttf");
    }*/


    :root {

      --fontSize: 20px;
      --lineHeight: 30px;
      --textShadow1: -0.4px -0.6px 0.3px rgb(160, 160, 160, 0.6), 0.4px 0.6px 0.3px rgb(70, 70, 70, 0.6),
        -0.8px -1.2px 3px rgb(215, 215, 215, 0.8), 1.6px 2.2px 4px rgb(0, 0, 0, 0.8),
        -2.4px -3.3px 8px rgb(255, 255, 255), 3.2px 4.4px 5px rgb(255, 255, 255);
    }

    BODY {
      font-style: oblique;
      font-size: var(--fontSize);
      line-height: var(--lineHeight);
      font-family: "Comic Sans MS", sans-serif;
      background-color: #b0b0b0;
      margin: 0;
      padding: 0;
      /*display: none;*/
    }

    div {
      margin: 0px;
      padding: 0px;
    }

    td {
      text-align: right;
      vertical-align: bottom;
    }

    ol {
      margin-top: 0;
      margin-bottom: 0;
    }

    ul {
      margin-top: 0;
      margin-bottom: 0;
    }

    p {
      margin-top: 0;
      margin-bottom: 0;
    }





    .text1 {
      color: rgba(0, 62, 21, 0.7);
      text-shadow: -0.2px -0.3px 0.3px rgba(60, 140, 99, 0.4), 0.3px 0.4px 0.5px rgba(0, 44, 0, 0.4);

    }

    .text2blue {
      color: rgba(28, 0, 152, 0.7);
      text-shadow: 0px 0px 1.3px rgb(0, 0, 0, 0.4);
    }

    .text2black {
      color: rgba(50, 50, 50, 0.9);
      text-shadow: 0px 0px 1.5px rgb(0, 0, 0, 0.5);
    }

    .text3 {
      color: rgb(0, 0, 0, 0.45);
      text-shadow: 0.2px 0.3px 0.3px rgb(255, 255, 255, 0.4), -0.4px -0.6px 0.6px rgb(0, 0, 0, 0.6), 0px 4px 3px rgb(225, 225, 225), 0px 6px 3px rgb(225, 225, 225), 0px 2px 3px rgb(225, 225, 225), 0px -2px 3px rgb(225, 225, 225), 2px 0px 3px rgb(225, 225, 225), -2px 0px 3px rgb(225, 225, 225), 0px -4px 4px rgb(225, 225, 225), 0px -6px 4px rgb(225, 225, 225), 0px -8px 4px rgb(225, 225, 225), 0px -10px 4px rgb(225, 225, 225), 0px -12px 4px rgb(225, 225, 225);

    }

    .text4 {
      color: rgb(0, 50, 150, 0.4);
      text-shadow: -0.2px -0.3px 0.3px rgb(150, 200, 255, 0.4), 0.3px 0.4px 0.5px rgb(0, 0, 100, 0.6);

    }

    .text5 {
      color: rgb(0, 0, 0, 0.3);
      text-shadow: -0.2px -0.3px 0.3px rgb(160, 160, 160, 0.6), 0.2px 0.3px 0.3px rgb(70, 70, 70, 0.6), -0.4px -0.6px 0.5px rgb(215, 215, 215, 0.4), 1px 1px 1px rgb(0, 0, 0, 0.6);

    }

    .text6 {
      color: rgb(0, 0, 0, 0.4);
      text-shadow: var(--textShadow1);
    }

    .text7 {
      color: rgba(50, 50, 50, 1);
      text-shadow: 0px 0px 2px rgba(255, 0, 0, 0.5);
    }



    .cellPaper {
      word-wrap: break-word;
      word-break: normal;
      min-width: 250px;
      margin: 5px;
      padding: 6px;
      background:
        linear-gradient(rgba(250, 250, 250, 0), rgba(0, 100, 255, 0.4), rgba(0, 100, 255, 0.4), rgba(250, 250, 250, 0) 2px),
        linear-gradient(90deg, rgba(250, 250, 250, 0.7), rgba(0, 100, 255, 0.4), rgba(0, 100, 255, 0.4), rgba(250, 250, 250, 0.7) 2px);
      background-size: var(--lineHeight) var(--lineHeight), var(--lineHeight) var(--lineHeight);
      background-position: 0 0, 0 0;

      box-shadow: 0px 13px 10px -10px rgba(0, 0, 0, .5), -11px 0px 10px -10px rgba(0, 0, 0, .5), 0px -10px 10px -10px rgba(0, 0, 0, .5), 11px 0px 10px -10px rgba(0, 0, 0, .5);
      border: 1px solid rgba(0, 0, 0, 0.35);
    }


    .sticker {
      word-wrap: break-word;
      word-break: normal;
      max-width: 400px;
      min-width: 260px;
      min-height: 350px;
      margin: auto;
      padding: 20px;
      padding-top: 15px;
      background: linear-gradient(hsla(57, 96%, 38%, 0.3) 70px, hsla(57, 96%, 28%, 0.3), hsla(57, 96%, 99%, 0) 75px),
        hsla(57, 96%, 48%, 0.65);
      box-shadow: 0px 13px 10px -10px rgba(0, 0, 0, .5), -11px 0px 10px -10px rgba(0, 0, 0, .5), 0px -10px 10px -10px rgba(0, 0, 0, .5), 11px 0px 10px -10px rgba(0, 0, 0, .5);
      border: 1px solid rgba(0, 0, 0, 0.35);
    }

    .mistery {
      font-family: Arial, Helvetica, sans-serif;
      text-align: left;
      word-wrap: break-word;
      word-break: normal;
      max-width: 300px;
      margin: 0px;
      padding: 4px;
      padding-top: 1px;
      margin-top: 50px;
      background:
        linear-gradient(hsl(255, 20%, 80%) 20px, hsl(255, 20%, 80%) 0px, hsl(44, 20%, 80%) 0px, hsl(44, 20%, 80%) 20px);
      background-size: 1px 40px;
      background-position: 0 0;
      box-shadow: 0px 13px 10px -10px rgba(0, 70, 0, .5), -11px 0px 10px -10px rgba(0, 70, 0, .5), 0px -10px 10px -10px rgba(0, 70, 0, .5), 11px 0px 10px -10px rgba(0, 70, 0, .5);

    }





    .header {
      text-align: right;
    }

    .footer {
      text-align: end;
      font-size: 12px;
      padding: 15px;
    }

    .button {
      filter: brightness(100%);
      vertical-align: center;
      width: fit-content;
      height: fit-content;
      display: inline-block;
      border-radius: 10px;
      background-color: rgba(180, 180, 180, 0.5);
      box-shadow: 1px 2px 3px 0px rgba(20, 20, 20, .5), inset 1px 1px 2px 0px rgba(255, 255, 255, .5), inset -1px -1px 2px 0px rgba(50, 50, 50, .5);
      transition: all 0.2s;
      user-select: none;
    }

    .button:hover {
      background-color: rgba(180, 180, 180, 0.6);
      box-shadow: 1px 2px 4px 0px rgba(20, 20, 20, 0.6), inset 2px 2px 4px 0px rgba(255, 255, 255, 0.6), inset -1.5px -1.5px 3px 0px rgba(50, 50, 50, 0.6);
    }

    .button:active {
      filter: brightness(95%);
      box-shadow: 0px 0px 0px 0px rgba(20, 20, 20, .5), inset 2px 2px 2px 0px rgba(50, 50, 50, .5), inset -2px -2px 2px 0px rgba(255, 255, 255, .5);

    }


    .sideMenu {
      visibility: hidden;
      opacity: 0;
      padding: calc((48px - 1em)/2);
      background-color: rgba(180, 180, 180, 1);
      box-shadow: 1px 2px 4px 0px rgba(20, 20, 20, 0.7), inset 2px 2px 4px 0px rgba(255, 255, 255, 0.7), inset -1.5px -1.5px 3px 0px rgba(50, 50, 50, 0.7);
      color: rgb(0, 0, 0, 0.4);
      text-shadow: -0.4px -0.6px 0.3px rgb(160, 160, 160, 0.6), 0.4px 0.6px 0.3px rgb(70, 70, 70, 0.6), -0.8px -1.2px 3px rgb(215, 215, 215, 0.8), 1.6px 2.2px 4px rgb(0, 0, 0, 0.8), 0.8px 1.1px 10px rgb(255, 255, 255), 0.8px 1.1px 10px rgb(255, 255, 255), 0.8px 1.1px 10px rgb(255, 255, 255);

    }

    .mainMenu {
      vertical-align: bottom;
      width: fit-content;
      height: fit-content;
      display: inline-block;
      border: 2px solid;
      border-top: 3px solid;
      border-bottom: 0px solid;
      border-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.0)) 1 stretch;
      transition: all 1s;
      user-select: none;
      visibility: hidden;
      opacity: 0;
      padding-top: calc((45px - 1em)/2 - 3px);
      padding-bottom: calc((45px - 1em)/2 + 3px);
      padding-left: 4px;
      padding-right: 6px;
      color: rgba(0, 0, 0, 0.5);
      text-shadow: var(--textShadow1);
      box-shadow: 1px 2px 4px 0px rgba(20, 20, 20, 0), inset 2px 2px 4px 0px rgba(255, 255, 255, 0), inset -1.5px -1.5px 3px 0px rgba(50, 50, 50, 0);
    }

    .mainMenu:hover {
      border: 2px solid;
      border-top: 0px solid;
      border-bottom: 0px solid;
      padding-top: calc((45px - 1em)/2);
      padding-bottom: calc((45px - 1em)/2);
      border-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)) 1 stretch;
      color: rgba(0, 0, 0, 0.7);
      text-shadow: -0.4px -0.6px 0.3px rgb(160, 160, 160, 0.6), 0.4px 0.6px 0.3px rgb(70, 70, 70, 0.6),
        -0.8px -1.2px 3px rgb(215, 215, 215, 0.8), 1.6px 2.2px 4px rgb(0, 0, 0, 1),
        -2.4px -3.3px 8px rgb(255, 255, 255), 3.2px 4.4px 5px rgb(255, 255, 255, 0.5);
      box-shadow: 1px 2px 4px 0px rgba(20, 20, 20, .7), inset 2px 2px 4px 0px rgba(255, 255, 255, .7), inset -1.5px -1.5px 3px 0px rgba(50, 50, 50, .7);

    }

    .mainMenuCard {
      opacity: 0;
      padding: 10px 30px;
      display: none;
      position: fixed;
      border-radius: 10px;
      box-shadow: 2px 3px 4px 0px rgba(20, 20, 20, .7), inset 2px 2px 4px 0px rgba(255, 255, 255, .7), inset -1.5px -1.5px 3px 0px rgba(50, 50, 50, .7);
      background-color: #ba80;
      width: fit-content;
      white-space: nowrap;
      overflow: hidden;

      transition: filter 1s ease-in;
      transition: opacity 0.8s;

      color: rgb(0, 0, 0, 0.6);
      text-shadow: var(--textShadow1);
      text-align: center;
    }

    .sideMenuLine {
      transition: all 2s;
    }

    .mainMenuLine {
      transition: all 2s;
    }



    input {
      width: 60%;
      display: block;
      background-color: transparent;
      border-color: transparent;
      margin-left: auto;
      margin-right: auto;
      padding: 30px;
      outline: none;
      font-family: "Comic Sans MS", sans-serif;
      text-align: center;
      font-size: var(--fontSize);
      line-height: var(--lineHeight);
      font-weight: bolder;
      transition: width 0.4s ease-out;
    }

    input:focus {
      width: 80%;
    }





    #tableOver1000px_contents {
      display: contents;
      width: calc(100% - 1px);
    }

    #tableCell1Over1000px_block {
      display: block;
    }

    #tableCell2Over1000px_block {
      display: block;
      padding: 15px;
    }

    #mainMenuOver1000 {
      width: max-content;
      display: none;
    }

    #langMenu {
      width: max-content;
      display: inline-block;
    }

    @media screen and (min-width: 1101px) {
      #sideMenuUnder1000 {
        display: none;
      }

      #mainMenuOver1000 {
        width: max-content;
        display: inline-block;
      }

      #tableOver1000px_contents {
        display: table;
        width: calc(100% - 1px);
      }

      #tableCell1Over1000px_block {
        display: table-cell;

      }

      #tableCell2Over1000px_block {
        display: table-cell;

        width: 450px;

      }
    }

    @media screen and (max-width: 1100px) {

      #langMenu {

        display: inline-block !important;
      }

    }

    #langSide6 {
      display: none;
    }

    @media screen and (max-width: 555px) {
      #langMain6 {
        display: none;
      }

      #langSide6 {
        display: inline-block;
      }
    }

    #langSide5 {
      display: none;
    }

    @media screen and (max-width: 490px) {
      #langMain5 {
        display: none;
      }

      #langSide5 {
        display: inline-block;
      }
    }

    #langSide4 {
      display: none;
    }

    @media screen and (max-width: 425px) {
      #langMain4 {
        display: none;
      }

      #langSide4 {
        display: inline-block;
      }
    }

    @media screen and (max-width: 500px) {}



    .pic {
      filter: drop-shadow(5px 10px 10px #000b);
      max-width: 100%;
      float: left;
      margin-right: 15px;
      shape-margin: 10px;
      transition: filter 1s cubic-bezier(0, 0.2, 0.9, 1.0);
    }

    .pic:hover {
      cursor: zoom-in;
    }

    #fsPic {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #888e;
    }
  </style>
  <script>

    function verifyJWT(token) {
      const parts = token.split('.');

      // 1. Prüfen, ob der Token genau 3 Teile hat
      if (parts.length !== 3) {
        throw new Error('Ungültiges JWT-Format');
      }

      const [encodedHeader, encodedPayload, signature] = parts;

      let payload;
      try {
        // 2. Payload dekodieren
        payload = JSON.parse(atob(encodedPayload.replace(/-/g, '+').replace(/_/g, '/').padEnd(Math.ceil(encodedPayload.length / 4) * 4, '=')));
      } catch (e) {
        throw new Error('Ungültiges Payload-Format ');
      }

      // 3. Ablaufdatum prüfen (falls vorhanden)
      const currentTime = Math.floor(Date.now() / 1000); // Aktuelle Zeit in Sekunden
      if (payload.e && currentTime > payload.e) {
        throw new Error('JWT abgelaufen');
      }

      // 4. Signatur neu generieren und prüfen (nur wenn die Zeit nicht abgelaufen ist) passiert natuerlich nur auf dem Server


      // 5. Payload zurückgeben, wenn alles korrekt ist
      return payload;
    }





    function toggleInfoRow(linkElement) {
      const row = linkElement.closest('tr'); // Die Hauptzeile
      const nextRow = row.nextElementSibling; // Die versteckte Zusatzzeile

      if (nextRow && nextRow.classList.contains('infoRow')) {
        // Sichtbarkeit umschalten
        nextRow.style.display = nextRow.style.display === 'none' ? 'table-row' : 'none';
      }
    }





    function myFetch(sendText = '', senderName = '', destination = 'output1', sendJWT = localStorage.getItem("jwt"), url = '/') {
      let formData = {};
      if (sendText === 'formSubmit') {
        // Сбор данных формы в JSON
        const elements = Array.from(document.getElementById(senderName).querySelectorAll('input, textarea, select'));
        elements.forEach(element => {
          if (element.value) {
            formData[element.id] = element.value;
          }
        });
        sendText = JSON.stringify(formData);
      }

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ text: sendText, name: senderName, dest: destination, jwt: sendJWT })
      })
        .then(async response => {
          if (!response.ok) {
            throw new Error('Ошибка сети: ' + response.statusText);
          }

          let blob;
          if (destination === 'pdfRma') {
            // PDF handling logic...
          } else if (destination === 'csv') {
            // CSV handling logic...
          } else {
            blob = await response.text();
            if (senderName == 'snInput' && sendText.split('.').length == 3) {
              const [encodedHeader, encodedPayload, signature] = sendText.split('.');
              localStorage.setItem("jwt", blob);
              myFetch('', 'startInput');
            }

            // Вставляем HTML в указанный элемент
            const targetElement = document.getElementById(destination);
            targetElement.innerHTML = blob;

            // Add this translation update
            if (window.i18n && window.i18n.getCurrentLanguage() !== 'en') {
              window.i18n.updatePageTranslations();

              // ADD THIS: Synchronize language UI with current language
              if (window.i18n.syncLanguageMasks) {
                window.i18n.syncLanguageMasks();
              } else {
                // Fallback synchronization if syncLanguageMasks isn't available
                const currentLang = window.i18n.getCurrentLanguage();
                document.documentElement.lang = currentLang;

                // Update mask states for language buttons
                const supportedLangs = ['de', 'en', 'fr', 'pl', 'cs', 'ko'];
                supportedLangs.forEach(lang => {
                  const maskElement = document.getElementById(`${lang}Mask`);
                  if (maskElement) {
                    maskElement.setAttribute("mask", "url(#maskClose)");
                  }
                });

                // Set current language mask to open
                const currentMask = document.getElementById(`${currentLang}Mask`);
                if (currentMask) {
                  currentMask.setAttribute("mask", "url(#maskOpen)");
                }
              }
            }

            // Проверяем, является ли это запросом для RMA-формы
            if (senderName === 'rmaButton' && url.includes('/rma/generate')) {
              // Добавляем ленивую загрузку скрипта RMA формы
              lazyLoadScript('/js/rma-form.js');
            }

            // Other handling logic...
          }
        })
        .catch(error => {
          console.error('Проблема с операцией Fetch:', error);
        });

      return false;
    }

    /**
     * Ленивая загрузка скрипта
     * @param {string} src - Путь к скрипту
         * @returns {Promise} - Promise, который разрешается, когда скрипт загружен
     */
    function lazyLoadScript(src) {
      // Проверяем, не загружен ли уже скрипт
      if (document.querySelector(`script[src="${src}"]`)) {
        return Promise.resolve(); // Скрипт уже загружен
      }

      // Создаем элемент script
      const script = document.createElement('script');
      script.src = src;
      script.defer = true; // Откладываем выполнение до загрузки документа

      // Возвращаем Promise для отслеживания загрузки
      return new Promise((resolve, reject) => {
        script.onload = () => {
          console.log(`Скрипт ${src} успешно загружен`);
          resolve();
        };
        script.onerror = (error) => {
          console.error(`Ошибка загрузки скрипта ${src}`);
          reject(error);
        };

        // Добавляем скрипт в документ
        document.body.appendChild(script);
      });
    }

    /**
     * Ленивая загрузка i18n для динамического контента
     * @param {HTMLElement} container - Контейнер с динамическим контентом
     * @returns {Promise} - Promise, который разрешается после обновления переводов
     */
    async function lazyLoadI18n(container) {
      // Проверяем наличие i18n скрипта
      if (!window.i18n) {
        try {
          // Загружаем i18n скрипт, если он еще не загружен
          await lazyLoadScript('/js/i18n.js');

          // Ждем инициализации i18n
          while (!window.i18n || !window.i18n.isInitialized()) {
            await new Promise(resolve => setTimeout(resolve, 100));
          }
        } catch (error) {
          console.error('Ошибка при загрузке i18n:', error);
          return;
        }
      }

      // Обновляем переводы в указанном контейнере
      if (window.i18n && window.i18n.getCurrentLanguage() !== 'en') {
        if (container) {
          // Обновляем переводы только для элементов в контейнере
          window.i18n.updateTranslations(container);
        } else {
          // Обновляем переводы для всей страницы
          window.i18n.updatePageTranslations();
        }
      }
    }






    /**
     * Konvertiert eine Eingabezeichenkette sicher in eine Ganzzahl.
     * Wenn die Eingabe keine gültige Ganzzahl am Anfang enthält, wird 0 zurückgegeben.
     *
     * @param {string} input - Die Eingabezeichenkette, die in eine Ganzzahl umgewandelt werden soll.
     * @returns {number} - Die geparste Ganzzahl oder 0, wenn keine Ganzzahl gefunden wurde.
     */
    function safeParseInt(input) {
      let match = input.match(/^\d+/);
      if (match) {
        return parseInt(match[0], 10);
      }
      return 0;
    }

    function myIpnutOnfocus(editId) {
      myEl = document.getElementById(editId);
      console.log(myEl.innerHTML)
      myEl.innerHTML = '';
      console.log(myEl.innerText)
    }
    function onFocusInt(editId) {
      myEl = document.getElementById(editId);
      if (myEl.innerText === '0') myEl.innerText = '';
    }
    function onFocusOutInt(editId, maxInt = 0) {
      console.log(maxInt);
      myEl = document.getElementById(editId);


      if ((myEl.innerText = safeParseInt(myEl.innerText)) > maxInt) {
        myEl.style.color = '#822';
      } else {
        myEl.style.color = '#072';
      }

    }

    function picFromSet(editId, picsArray = []) {
      myEl = document.getElementById(editId);
      if (picsArray.length && myEl.getAttribute('src') === '') {
        const ind = Math.floor(Math.random() * picsArray.length);
        myEl.setAttribute('src', `/storage/pics/${picsArray[ind]}.webp`);
        myEl.setAttribute('onclick', `fsPic('/storage/pics/${picsArray[ind]}.avif')`);
      }
    }

    let removePiselRatio = null;
    const updatePixelRatio = () => {
      if (removePiselRatio != null) {
        removePiselRatio();
      }
      const mqString = `(resolution: ${window.devicePixelRatio}dppx)`;
      const media = matchMedia(mqString);
      media.addEventListener("change", updatePixelRatio);
      removePiselRatio = () => {
        media.removeEventListener("change", updatePixelRatio);
      };

      Array.from(document.getElementsByTagName("feConvolveMatrix")).forEach(element => {
        if (typeof element.getAttribute('id') === 'string') {
          elt = element.getAttribute('id').split('_|_');
          if (elt.length === 2) {
            s = elt[0] * window.devicePixelRatio;

            maxCount = Math.ceil(s * 2);
            kernelMatix = '';
            divisor = 0;
            for (i = -maxCount; i <= maxCount; i++) {
              y = ~~(1000 * Math.exp((-i * i) / (s * s)));
              divisor += y;
              kernelMatix += ` ${y}`;
            }
            element.setAttribute('kernelMatrix', kernelMatix);
            element.setAttribute('divisor', divisor);
            if (elt[1] === 'y') {
              element.setAttribute('order', `1,${2 * maxCount + 1}`)
            } else {
              element.setAttribute('order', `${2 * maxCount + 1},1`)
            }
          }
        }






      });



    };





    var waitForTransition = false;

    function showMenu(menuType) {
      if (waitForTransition) return;
      const elements = Array.from(document.getElementsByClassName(`${menuType}Line`));


      if (document.getElementById(`${menuType}Buttons`).style.display !== "none") {
        waitForTransition = true;
        setTimeout(() => {
          document.getElementById(`${menuType}Buttons`).style.display = "none";
          if (menuType === "mainMenu") document.getElementById("langMenu").style.display = "inline-block";
          waitForTransition = false;
        }, 3000);
      } else {
        if (menuType === "mainMenu") document.getElementById("langMenu").style.display = "none";
        document.getElementById(`${menuType}Buttons`).style.display = "inline-block";
      }

      if (elements[1].getAttribute("x") === "10") {
        elements[1].setAttribute("x", "65");
        elements[0].style.transform = "rotate(-45deg)";
        elements[2].style.transform = "rotate(45deg)";
        Array.from(document.getElementsByClassName(menuType)).forEach(element => {
          element.style.transitionDuration = `${(0.5 + Math.random())}s`;
          element.style.transitionDelay = `${Math.random()}s`;

          setTimeout(() => {
            element.style.visibility = "visible";
            element.style.opacity = 1;
          }, 67);
        });
        setTimeout(() => {
          Array.from(document.getElementsByClassName(menuType)).forEach(element => {
            element.style.transitionDuration = "0.3s";
            element.style.transitionDelay = "0s";

          });
        }, 2000);
      } else {
        elements[1].setAttribute("x", "10");
        elements[0].style.transform = "rotate(0deg)";
        elements[2].style.transform = "rotate(0deg)";
        Array.from(document.getElementsByClassName(menuType)).forEach(element => {

          element.style.transitionDuration = `${(0.5 + Math.random())}s`;
          element.style.transitionDelay = `${Math.random()}s`;
          setTimeout(() => {
            element.style.visibility = "hidden";
            element.style.opacity = 0;
          }, 69);
        });
      }

    }
    var menuUsed = false;
    var language = document.documentElement.lang ||
      (window.APP_CONFIG && window.APP_CONFIG.DEFAULT_LANGUAGE) ||
      'en';



    function setLanguage(langPos) {
      // If i18n is available, use it
      if (window.i18n && window.i18n.isInitialized) {
        // Either use the direct language code or extract from the element
        let newLanguage;
        if (langPos.slice(0, 4) === "lang") {
          menuUsed = true;
          newLanguage = document.getElementById(langPos).getAttribute("href").slice(1);
        } else {
          newLanguage = langPos;
        }

        // Let i18n handle everything else
        window.i18n.changeLanguage(newLanguage);
        return;
      }

      // If i18n isn't available, keep the original fallback behavior
      // (This is the same logic as in the original function)
      const previousLanguage = language;
      let newLanguage;
      if (langPos.slice(0, 4) === "lang") {
        menuUsed = true;
        newLanguage = document.getElementById(langPos).getAttribute("href").slice(1);
      } else {
        newLanguage = langPos;
      }

      if (newLanguage === language) return;

      // Visual updates for SVG masks
      try {
        document.getElementById(`${previousLanguage}Mask`).setAttribute("mask", "url(#maskClose)");
      } catch (e) { /* Silent catch */ }

      language = newLanguage;

      try {
        document.getElementById(`${language}Mask`).setAttribute("mask", "url(#maskOpen)");
      } catch (e) { /* Silent catch */ }

      // Store in cookies/localStorage and reload
      document.cookie = `i18next=${language}; path=/; max-age=${60 * 60 * 24 * 365}`;
      try {
        localStorage.setItem('i18nextLng', language);
      } catch (e) { /* Silent catch */ }

      window.location.reload();
    }

    function fsPic(name) {
      const el = document.getElementById("fsPic");
      const img = new Image();
      img.onload = function () {
        el.style.background = `linear-gradient(#b69c6850, #c6b89b50, #b69c6850),
        linear-gradient(90deg,#b69c68, #c6b89b, #b69c68)`;
        el.style.overflow = 'hidden';
        this.style.cursor = 'zoom-in';

        if (this.width / window.innerWidth > this.height / window.innerHeight) {
          this.style.marginTop = (window.innerHeight - this.height * window.innerWidth / this.width) / 2 + 'px';
          this.width = window.innerWidth;
        } else {
          this.style.marginLeft = (window.innerWidth - this.width * window.innerHeight / this.height) / 2 + 'px';
          this.height = window.innerHeight;
        }
        this.addEventListener("click", tempFa = (event) => {
          if (this.style.cursor == 'zoom-in') {
            this.style.cursor = 'zoom-out';
            el.style.overflow = 'scroll';
            this.width = this.naturalWidth;
            this.height = this.naturalHeight;
            this.style.marginTop = (window.innerHeight - this.height) > 0 ? (window.innerHeight - this.height) / 2 + 'px' : 0;
            this.style.marginLeft = (window.innerWidth - this.width) > 0 ? (window.innerWidth - this.width) / 2 + 'px' : 0;
            tx = 2 * (this.width - window.innerWidth) / window.innerWidth;
            ty = 2 * (this.height - window.innerHeight) / window.innerHeight;
            el.scroll((event.clientX - window.innerWidth / 4) * tx, (event.clientY - window.innerHeight / 4) * ty);
            this.addEventListener("mousemove", tempFb = (event) => {
              el.scroll((event.clientX - window.innerWidth / 4) * tx, (event.clientY - window.innerHeight / 4) * ty);
            });
          } else {
            this.removeEventListener("mousemove", tempFb);
            this.removeEventListener("click", tempFa);
            this.remove(1);
            document.body.style.overflow = "visible";
            el.style.display = "none";
          }
        });
        el.appendChild(this);
        el.style.display = "block";
        document.body.style.overflow = "hidden";
      }
      img.src = name;
    }



    var backButtonImg;
    var cards;
    function mainMenuCardOpen(mainMenuNumber) {

      const menu = document.getElementById(mainMenuNumber);
      menu.style.backgroundColor = "#ba87";
      var zmin = ~~(cards[0].el.style.zIndex);
      var zmax = ~~(cards[0].el.style.zIndex);
      var equal = false;
      var i = 0;
      cards.forEach((element, index) => {
        if (element.mmn === mainMenuNumber) {
          equal = true;
          clearTimeout(element.timeoutId);
          clearTimeout(element.timeoutId1);
        }
        const z = ~~(element.el.style.zIndex);
        if (zmin >= z) {
          zmin = z;
          i = index;
        }
        if (zmax < z) {
          zmax = z;
        }
      });
      if (equal) {
        return;
      } else {
        cards.forEach((element, index) => {
          if (index !== i) {

            element.el.style.opacity = "0";
            element.el.style.filter = "blur(10px)";
            element.mmn = "empty";
            element.el.onmouseenter = () => { };
            element.el.onmouseleave = () => { };
          }
        });
      }

      clearTimeout(cards[i].timeoutId);
      clearTimeout(cards[i].timeoutId1);
      cards[i].el.style.zIndex = `${zmax + 1}`;
      cards[i].el.style.display = "block";
      cards[i].el.onmouseenter = () => { mainMenuCardOpen(mainMenuNumber) };
      cards[i].el.onmouseleave = () => { mainMenuCardClose(mainMenuNumber) };
      cards[i].el.innerHTML = menu.getElementsByTagName("div")[0].innerHTML;
      cards[i].mmn = mainMenuNumber;
      cards[i].el.style.left = `${~~(event.clientX - event.clientX * cards[i].el.offsetWidth / window.innerWidth)}px`;
      cards[i].el.style.top = `${~~(Math.random() * 50 + 70)}px`;
      cards[i].el.style.opacity = "1";
      cards[i].el.style.filter = "blur(0px)";
    }

    function mainMenuCardClose(mainMenuNumber) {

      const menu = document.getElementById(mainMenuNumber);
      menu.style.backgroundColor = "#ba80";

      cards.forEach((element, index) => {
        if (element.mmn === mainMenuNumber) {
          element.timeoutId = setTimeout(() => {
            element.el.style.opacity = "0";
            element.el.style.filter = "blur(10px)";
            element.mmn = "empty";
            element.el.onmouseenter = () => { };
            element.el.onmouseleave = () => { };
            element.timeoutId1 = setTimeout(() => {
              element.el.style.display = "none";
            }, 500);
          }, 1000)

        }
      });

    }


    window.addEventListener("DOMContentLoaded", (event) => {
      updatePixelRatio();

      if (!chrome) {

        Array.from(document.getElementsByTagName("feDiffuseLighting")).forEach(element => {
          sc = element.getAttribute('surfaceScale');
          element.setAttribute('surfaceScale', surfaceScaleDif);
          element.children[0].setAttribute('elevation', elevation);

        });

        Array.from(document.getElementsByTagName("feSpecularLighting")).forEach(element => {
          sc = element.getAttribute('surfaceScale');
          element.setAttribute('surfaceScale', surfaceScaleSpec);
          element.setAttribute('specularExponent', specularExponent);
          element.children[0].setAttribute('elevation', elevation);

        });
      }

      Array.from(document.getElementsByClassName("seed")).forEach(element => {
        element.setAttribute('seed', seed);
      });

      Array.from(document.getElementsByClassName("myInput")).forEach((element, index) => {
        element.setAttribute('id', `myInput${index}`);
        element.setAttribute('contenteditable', true);
        element.setAttribute('onkeyup', "myIpnutOnkeyup()");
        element.setAttribute('onfocus', `myIpnutOnfocus("myInput${index}")`);
      });


      Array.from(document.getElementsByClassName("seed")).forEach(element => {
        element.setAttribute('seed', seed);
      });

      Array.from(document.getElementsByClassName("sticker")).forEach(element => {
        element.style.transform = `rotate(${Math.random() * 9 - 4.5}deg)`
        Array.from(element.getElementsByTagName('svg')).forEach(innerElement => {
          var hueAngle = Math.random() * 360;
          if (hueAngle < (57 + 25) && hueAngle > (57 - 15)) {
            hueAngle -= 40;
          }
          innerElement.style.filter = `hue-rotate(${hueAngle}deg)`;
        });
      });



      backButtonImg = `url(data:image/svg+xml;charset=utf-8;base64,${btoa(backSvg2)})`;






      backButtonImg = `url(data:image/svg+xml;charset=utf-8;base64,${btoa(backSvg2)})`;
      Array.from(document.getElementsByClassName("button")).forEach(element => {
        element.style.backgroundImage = backButtonImg;
      });


      document.body.style.backgroundImage = `url(data:image/svg+xml;charset=utf-8;base64,${btoa(backSvg)})`;


      cards = Array.from(document.getElementsByClassName("mainMenuCard"), (element, index) => {
        element.style.backgroundImage = `
        linear-gradient(90deg,#ba80 0%,#ba84 10%,#ba88 20%,#ba8c 30%,#ba8f 40%,  #ba8f 60%,#ba8c 70%,#ba88 80%,#ba84 90%,#ba80 100%),
        linear-gradient(30deg,#ba80,#ba80,#ba80,#ba8f,#ba8f,#ba80,#ba80,#ba80,#ba8f,#ba8f,#ba80,#ba80,#ba80,#ba8f,#ba8f,#ba80,#ba80,#ba80),
        `+ backButtonImg;
        return { el: element, mmn: "" }
      });



      /*lableSize = ~~(screen.width > 1000 ? 35 * 1.5 : (screen.width < 500 ? 35 : ~~(70 * (0.5 + 0.5 * (screen.width / 500 - 1)))))
      labelElement = document.getElementById("betrugerSvg")
      labelElement.setAttribute("width", `${lableSize * 3}`);
      labelElement.setAttribute("height", `${lableSize * 2}`); 

      document.getElementById("capPath").setAttribute("d", "M72,89 C78.6,68 67.2,30.7 89,68 C86.9,37.6 66.91,32 62,61 C58,44.1 67.5,38.8 52,10 C53.6,47 46.91,36.2 45,61 C39.3,43.4 22,46.6 13,43 C32.9,55.8 35.7,66.62 32,89 C35,97.9 68.6,99 72,89 Z");
      document.getElementById("bell1").setAttribute("x", "13");
      document.getElementById("bell1").setAttribute("y", "43");
      document.getElementById("bell3").setAttribute("x", "89");
      document.getElementById("bell3").setAttribute("y", "68");
      document.getElementById("bell").setAttribute("r", "5.5");*/

      setTimeout(() => {
        if (window.matchMedia("(min-width: 1001px)").matches) {
          if (document.getElementById("mainMenuButtons").style.display === "none") {
            if (!menuUsed) {
              showMenu("mainMenu");
            }
          }
        }
      }, 30000);

      snInputInit = (destin = 'output2') => {
        snInput.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            event.preventDefault();
            if (snInput.value === "0000000") document.getElementById("snInputText").innerText = navigator.userAgent;

            myFetch(snInput.value, "snInput", destin);
            snInput.value = '';

          }

        });

        snInput.addEventListener("keyup", (event) => {
          /*snInput.value = snInput.value.replace(/[^0-9]/g, '');*/
          if (/^\d{7}$/.test(snInput.value)) {
            snInput.style.color = "rgb(0, 100, 50)";
            document.getElementById("snInputTextUp").innerHTML = "<br><br>can be the M3 device serial number<br><br>";
          } else if (/^RMA\d{10}[A-Za-z0-9]{2}$/.test(value)) {
            snInput.style.color = "rgb(0, 100, 50)";
            snTextUp.innerHTML = "<br><br>can be the M3 RMA serial number<br><br>";
          } else if (/^\d{4}[A-Za-z0-9]\d{7}$/.test(snInput.value)) {
            snInput.style.color = "rgb(0, 100, 50)";
            document.getElementById("snInputTextUp").innerHTML = "<br><br>can be the M3 replacement part number<br><br>";
          } else {
            snInput.style.color = "rgba(26, 26, 147, 0.7)";
          }
        });
        setTimeout(() => { snInput.focus({ preventScroll: true }); }, 1000);
      };

      var snInput = document.getElementById("snInput");
      if (snInput) {
        snInput.style.background = `center / 100% 100% no-repeat url(data:image/svg+xml;charset=utf-8;base64,${btoa(backSvg3)})`;
        snInputInit();
      }
      if (localStorage.getItem("jwt")) myFetch('', 'startInput');

      // Обновленный код для обработчика DOMContentLoaded в index.html

      // Проверка загрузки translationUtils перед инициализацией i18n
      function checkTranslationUtils() {
        // Проверяем доступность translationUtils
        if (!window.translationUtils) {
          console.log('[i18n] Waiting for translationUtils to load...');

          // Ждем загрузки utils перед инициализацией i18n
          const checkInterval = setInterval(function () {
            if (window.translationUtils) {
              console.log('[i18n] translationUtils loaded');
              clearInterval(checkInterval);

              // Если i18n уже загружен и есть функция инициализации - вызываем ее
              if (window.i18n && typeof window.i18n.init === 'function') {
                console.log('[i18n] Initializing i18n from checkTranslationUtils');
                window.i18n.init();
              }
            }
          }, 50); // Проверяем каждые 50мс
        }
      }

      // Вызываем проверку, после всей инициализации страницы
      setTimeout(checkTranslationUtils, 0);



    });






    if (screen.width < screen.height) {
      scrWidth = scrHeight = ~~(screen.width / 5);
    } else {
      scrWidth = scrHeight = ~~(screen.height / 3);
    }
    seed = ~~(Math.random() * 1000);
    baseFrequency = 0.025;
    viewBox = ``;
    numOctaves = 10;
    matrix1 = `
    0 0 0 0 0 
    0 0 0 0 0 
    0 0 0 0 0 
    0.25 0.25 0.25 0.25 0`;


    chrome = true;
    surfaceScaleDif = 2;
    elevation = 20;
    surfaceScaleSpec = 1;
    specularExponent = 40;
    tempUserAgent = navigator.userAgent.toLowerCase();
    if ((tempIndex = tempUserAgent.indexOf('chrome/')) > -1) {
      if (tempUserAgent.slice(tempIndex + 7, tempIndex + 10) < 117) {
        surfaceScaleDif = 6;
        elevation = 20;
        surfaceScaleSpec = 4;
        chrome = false;
      }
    }
    if (navigator.userAgent.toLowerCase().indexOf('mac') > -1) {
      surfaceScaleDif = 2;
      elevation = 30;
      surfaceScaleSpec = 4;
      chrome = false;
    }
    if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
      surfaceScaleDif = 4;
      elevation = 38;
      surfaceScaleSpec = 1.5;
      specularExponent = 50;
      chrome = false;
    }






// Добавьте эти функции в конец секции <script> в начале файла

/**
 * Показывает или скрывает всплывающее меню выбора языка
 * @param {string} popupType - Тип всплывающего меню ('eu' или 'un')
 */
 function toggleLanguagePopup(popupType) {
  const euPopup = document.getElementById('euPopup');
  const unPopup = document.getElementById('unPopup');
  
  // Закрыть все меню если они открыты
  if (popupType === 'eu') {
    if (euPopup.classList.contains('visible')) {
      euPopup.classList.remove('visible');
    } else {
      unPopup.classList.remove('visible'); // Закрыть другое меню
      euPopup.classList.add('visible');
      highlightCurrentLanguage(euPopup);
    }
  } else if (popupType === 'un') {
    if (unPopup.classList.contains('visible')) {
      unPopup.classList.remove('visible');
    } else {
      euPopup.classList.remove('visible'); // Закрыть другое меню
      unPopup.classList.add('visible');
      highlightCurrentLanguage(unPopup);
    }
  }
}

/**
 * Выделяет текущий выбранный язык во всплывающем меню
 * @param {HTMLElement} popup - Всплывающее меню
 */
function highlightCurrentLanguage(popup) {
  const currentLang = getCurrentLanguage();
  const buttons = popup.querySelectorAll('.langButton');
  
  buttons.forEach(button => {
    button.classList.remove('active');
    
    // Извлекаем код языка из обработчика клика
    const onclickAttr = button.getAttribute('onclick');
    if (onclickAttr) {
      const langMatch = onclickAttr.match(/selectLanguage\(['"]([a-z]{2})['"]\)/);
      if (langMatch && langMatch[1] === currentLang) {
        button.classList.add('active');
      }
    }
  });
}

/**
 * Получает текущий язык из разных источников
 * @returns {string} - Код языка (например 'en', 'de', 'fr')
 */
function getCurrentLanguage() {
  // Проверяем глобальную переменную
  if (typeof language !== 'undefined' && language) {
    return language;
  }
  
  // Проверяем HTML lang атрибут
  const htmlLang = document.documentElement.lang;
  if (htmlLang) {
    return htmlLang;
  }
  
  // Проверяем i18next cookie
  const cookieMatch = document.cookie.match(/i18next=([^;]+)/);
  if (cookieMatch) {
    return cookieMatch[1];
  }
  
  // Проверяем localStorage
  try {
    const lsLang = localStorage.getItem('i18nextLng');
    if (lsLang) {
      return lsLang;
    }
  } catch (e) {
    // Игнорируем ошибки localStorage
  }
  
  // Возвращаем английский по умолчанию
  return 'en';
}

/**
 * Выбирает язык и перестраивает языковую панель
 * @param {string} langCode - Код языка (например 'en', 'de', 'fr')
 */
function selectLanguage(langCode) {
  // Закрыть все всплывающие меню
  document.getElementById('euPopup').classList.remove('visible');
  document.getElementById('unPopup').classList.remove('visible');
  
  // Получаем текущий язык
  const previousLanguage = getCurrentLanguage();
  
  // Если выбран тот же язык, просто закрываем меню
  if (langCode === previousLanguage) {
    return;
  }
  
  // Вызываем существующую функцию setLanguage, но с модификацией для меню eu/un
  if (window.i18n && window.i18n.changeLanguage) {
    // Используем функцию i18n, если она доступна
    window.i18n.changeLanguage(langCode);
  } else {
    // Резервный вариант: использовать существующую функцию setLanguage
    // Но сначала перестраиваем языковую панель
    reorganizeLanguageButtons(langCode, previousLanguage);
    
    // Обновляем маски SVG как в оригинальной функции
    try {
      document.getElementById(`${previousLanguage}Mask`).setAttribute("mask", "url(#maskClose)");
    } catch (e) { /* Игнорируем ошибки */ }
    
    try {
      document.getElementById(`${langCode}Mask`).setAttribute("mask", "url(#maskOpen)");
    } catch (e) { /* Игнорируем ошибки */ }
    
    // Обновляем переменную языка
    window.language = langCode;
    
    // Сохраняем в cookie и localStorage
    document.cookie = `i18next=${langCode}; path=/; max-age=${60 * 60 * 24 * 365}`;
    try {
      localStorage.setItem('i18nextLng', langCode);
    } catch (e) { /* Игнорируем ошибки */ }
    
    // Перезагружаем страницу с новым языком
    const cacheBuster = Date.now();
    const url = new URL(window.location.href);
    url.searchParams.set('i18n_cb', cacheBuster);
    url.searchParams.set('lang', langCode);
    window.location.href = url.toString();
  }
}

/**
 * Перестраивает панель языковых кнопок, чтобы выбранный язык был на месте английского
 * @param {string} selectedLang - Выбранный язык
 * @param {string} previousLang - Предыдущий язык
 */
function reorganizeLanguageButtons(selectedLang, previousLang) {
  // Языковая панель
  const langMenu = document.getElementById('langMenu');
  if (!langMenu) return;
  
  // Находим кнопку для выбранного языка (если она есть)
  let selectedButton = null;
  const buttons = langMenu.querySelectorAll('.button');
  
  buttons.forEach(button => {
    const svg = button.querySelector('svg use');
    if (svg && svg.getAttribute('href') === `#${selectedLang}`) {
      selectedButton = button;
    }
  });
  
  // Если кнопка уже есть, мы должны переместить ее
  if (selectedButton) {
    // Найдем кнопку для английского языка (или текущего языка)
    let englishButton = null;
    buttons.forEach(button => {
      const svg = button.querySelector('svg use');
      if (svg && svg.getAttribute('href') === `#${previousLang}`) {
        englishButton = button;
      }
    });
    
    // Если нашли обе кнопки, меняем их местами
    if (englishButton && selectedButton) {
      const parent = langMenu;
      
      // Сохраняем исходные позиции
      const engPosition = Array.from(parent.children).indexOf(englishButton);
      const selectedPosition = Array.from(parent.children).indexOf(selectedButton);
      
      // Меняем кнопки местами
      if (engPosition !== -1 && selectedPosition !== -1) {
        if (engPosition < selectedPosition) {
          parent.insertBefore(selectedButton, englishButton);
        } else {
          parent.insertBefore(selectedButton, englishButton.nextSibling);
        }
      }
    }
  }
}

// Добавляем обработчик клика вне меню для закрытия
document.addEventListener('click', function(event) {
  const euPopup = document.getElementById('euPopup');
  const unPopup = document.getElementById('unPopup');
  
  // Проверяем клик для EU меню
  const euButton = document.querySelector('[onclick="setLanguage(\'lang2\')"]');
  if (euPopup && euPopup.classList.contains('visible') && 
      !euPopup.contains(event.target) && 
      (!euButton || !euButton.contains(event.target))) {
    euPopup.classList.remove('visible');
  }
  
  // Проверяем клик для UN меню
  const unButton = document.querySelector('[onclick="setLanguage(\'lang1\')"]');
  if (unPopup && unPopup.classList.contains('visible') && 
      !unPopup.contains(event.target) && 
      (!unButton || !unButton.contains(event.target))) {
    unPopup.classList.remove('visible');
  }
});

// Модифицируем существующую функцию setLanguage для поддержки всплывающих меню
const originalSetLanguage = window.setLanguage;
window.setLanguage = function(langPos) {
  // Проверяем, не является ли это запросом на открытие меню
  if (langPos === 'lang2' || langPos === 'eu') {
    toggleLanguagePopup('eu');
    return;
  } else if (langPos === 'lang1' || langPos === 'un') {
    toggleLanguagePopup('un');
    return;
  }
  
  // В противном случае вызываем оригинальную функцию
  if (originalSetLanguage) {
    originalSetLanguage(langPos);
  }
};

// Инициализируем отображение после загрузки страницы
document.addEventListener('DOMContentLoaded', function() {
  // Добавляем классы для оформления кнопок eu и un
  const euButton = document.querySelector('[onclick="setLanguage(\'lang2\')"]');
  const unButton = document.querySelector('[onclick="setLanguage(\'lang1\')"]');
  
  if (euButton) {
    euButton.classList.add('euLangButton');
    euButton.title = 'European Union Languages';
  }
  
  if (unButton) {
    unButton.classList.add('unLangButton');
    unButton.title = 'Other Languages';
  }
});

  </script>
  <script src="/js/translationUtils.js" defer></script>
  <script src="/js/i18n.js" defer></script>
</head>

<body>
  <div style="padding-top: 3px;padding-right: 3px;" class="header" id="myHeader">
    <a href="https://betruger.com/" style="width: min-content;display: inline-block;">
      <svg id="betrugerSvg" xmlns="http://www.w3.org/2000/svg" style="position: absolute; left: 0px; top: 0px;"
        viewBox="0 0 110 110" width="110" height="110">
        <use href="#betruger"></use>
      </svg>
    </a>

    <div id="langMenu" style="width: max-content;display: inline-block; border: 0px solid #fff; border-radius: 30px; background-color: #fff3;
      box-shadow: 0px 0px 30px -15px rgba(255, 255, 255)">
      <div id="langMain6" onclick="setLanguage('lang6')" class="button">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <use id="lang6" href="#ko" />
        </svg>
      </div>
      <div id="langMain5" onclick="setLanguage('lang5')" class="button">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <use id="lang5" href="#fr" />
        </svg>
      </div>
      <div id="langMain4" onclick="setLanguage('lang4')" class="button">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <use id="lang4" href="#de" />
        </svg>
      </div>
      <div onclick="setLanguage('lang3')" class="button">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <use id="lang3" href="#en" />
        </svg>
      </div>
      <div onclick="setLanguage('lang2')" class="button">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <use id="lang2" href="#eu" />
        </svg>
      </div>
      <div onclick="setLanguage('lang1')" class="button">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <use id="lang1" href="#un" />
        </svg>
      </div>
    </div>

    <!-- START of CONTENT -->
    <div id="euPopup" class="langPopup">
      <div class="langPopupHeader">
        <h3 data-i18n="language.select">Выберите язык</h3>
        <button class="langPopupClose" onclick="toggleLanguagePopup('eu')">×</button>
      </div>
      <div class="langGrid">
        <div class="langButton" onclick="selectLanguage('de')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#de" />
          </svg>
          <span data-i18n="language.de">Deutsch</span>
        </div>
        <div class="langButton" onclick="selectLanguage('fr')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#fr" />
          </svg>
          <span data-i18n="language.fr">Français</span>
        </div>
        <div class="langButton" onclick="selectLanguage('it')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#it" />
          </svg>
          <span data-i18n="language.it">Italiano</span>
        </div>
        <div class="langButton" onclick="selectLanguage('es')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#es" />
          </svg>
          <span data-i18n="language.es">Español</span>
        </div>
        <div class="langButton" onclick="selectLanguage('pt')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#pt" />
          </svg>
          <span data-i18n="language.pt">Português</span>
        </div>
        <div class="langButton" onclick="selectLanguage('nl')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#nl" />
          </svg>
          <span data-i18n="language.nl">Nederlands</span>
        </div>
        <!-- Можно добавить остальные языки ЕС -->
      </div>
    </div>
    
    <!-- Всплывающее меню для других языков (ООН) -->
    <div id="unPopup" class="langPopup">
      <div class="langPopupHeader">
        <h3 data-i18n="language.select">Выберите язык</h3>
        <button class="langPopupClose" onclick="toggleLanguagePopup('un')">×</button>
      </div>
      <div class="langGrid">
        <div class="langButton" onclick="selectLanguage('ru')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#ru" />
          </svg>
          <span data-i18n="language.ru">Русский</span>
        </div>
        <div class="langButton" onclick="selectLanguage('zh')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#zh" />
          </svg>
          <span data-i18n="language.zh">中文</span>
        </div>
        <div class="langButton" onclick="selectLanguage('ar')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#ar" />
          </svg>
          <span data-i18n="language.ar">العربية</span>
        </div>
        <div class="langButton" onclick="selectLanguage('ja')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#ja" />
          </svg>
          <span data-i18n="language.ja">日本語</span>
        </div>
        <div class="langButton" onclick="selectLanguage('ko')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#ko" />
          </svg>
          <span data-i18n="language.ko">한국어</span>
        </div>
        <div class="langButton" onclick="selectLanguage('tr')">
          <svg width="30" height="25" xmlns="http://www.w3.org/2000/svg">
            <use href="#tr" />
          </svg>
          <span data-i18n="language.tr">Türkçe</span>
        </div>
        <!-- Можно добавить остальные языки ООН и другие -->
      </div>
    </div>


    <div id="mainMenuOver1000">
      <div id="mainMenuButtons" style="width: max-content;display: none;">


        <div id="mainMenu12" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu12')"
          onmouseleave="mainMenuCardClose('mainMenu12')" onclick="myFetch('partsOX10','mainMenu12')">
          OX10
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/OX10.webp"
              onclick="myFetch('partsOX10')" />
          </div>
        </div>
        <div id="mainMenu11" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu11')"
          onmouseleave="mainMenuCardClose('mainMenu11')" onclick="myFetch('partsBK10','mainMenu11')">
          BK10
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/BK10.webp"
              onclick="myFetch('partsBK10')" />
          </div>
        </div>
        <div id="mainMenu10" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu10')"
          onmouseleave="mainMenuCardClose('mainMenu10')" onclick="myFetch('partsSM10','mainMenu10')">
          SM10
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/sm15.webp"
              onclick="myFetch('partsSM10')" />
          </div>
        </div>
        <div id="mainMenu9" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu9')"
          onmouseleave="mainMenuCardClose('mainMenu9')" onclick="myFetch('partsSM15','mainMenu9')">
          SM15
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/sm15.webp"
              onclick="myFetch('partsSM15')" />
          </div>
        </div>
        <div id="mainMenu8" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu8')"
          onmouseleave="mainMenuCardClose('mainMenu8')" onclick="myFetch('partsSM20','mainMenu8')">
          SM20
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/SM20.webp"
              onclick="myFetch('partsSM20')" />
          </div>
        </div>
        <div id="mainMenu7" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu7')"
          onmouseleave="mainMenuCardClose('mainMenu7')" onclick="myFetch('partsSL20','mainMenu7')">
          SL20
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/SL20.webp"
              onclick="myFetch('partsSL20')" />
          </div>
        </div>
        <div id="mainMenu6" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu6')"
          onmouseleave="mainMenuCardClose('mainMenu6')" onclick="myFetch('partsSL20K','mainMenu6')">
          SL20K
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/SL20K.webp"
              onclick="myFetch('partsSL20K')" />
          </div>
        </div>
        <div id="mainMenu5" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu5')"
          onmouseleave="mainMenuCardClose('mainMenu5')" onclick="myFetch('partsUS20','mainMenu5')">
          US20
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/US20.webp"
              onclick="myFetch('partsUS20')" />
          </div>
        </div>
        <div id="mainMenu4" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu4')"
          onmouseleave="mainMenuCardClose('mainMenu4')" onclick="myFetch('partsUL20','mainMenu4')">
          UL20
          <div hidden>
            <img class="picBtn" loading="lazy" height="300" src="storage/pics/ul20.webp"
              onclick="myFetch('partsUL20')" />
          </div>
        </div>

        <div id="mainMenu1" class="mainMenu" onmouseenter="mainMenuCardOpen('mainMenu1')"
          onmouseleave="mainMenuCardClose('mainMenu1')">
          KUNDE

          <div hidden>
            <div class="myInput">Suche Nach M3 Partnummer</div><br>




          </div>
        </div>
      </div>
      <div onclick="showMenu('mainMenu');"
        style="box-shadow: none; background: rgba(150, 150, 150, 0);vertical-align: bottom;display: inline-block;width: fit-content;height: fit-content">
        <svg width="60" height="50" xmlns="http://www.w3.org/2000/svg">
          <g>
            <g filter="url(#sh002)">
              <rect class="mainMenuLine" fill="#998566" height="7" rx="3" stroke-width="0" width="40" x="10" y="7"
                style="transform-origin: 85% 35%;" />
              <rect class="mainMenuLine" fill="#998566" height="7" rx="3" stroke-width="0" width="40" x="10" y="21" />
              <rect class="mainMenuLine" fill="#998566" height="7" rx="3" stroke-width="0" width="40" x="10" y="35"
                style="transform-origin: 74% 70%;" />
            </g>
          </g>
        </svg>
      </div>
    </div>
  </div>



  <div id="output1">

    <div id="tableOver1000px_contents">
      <div id="tableCell1Over1000px_block">
        <div id='output2' class="cellPaper">

          <img id="mainPic" class="pic" loading="lazy" src="" onclick="" onerror="picFromSet('mainPic',['ul20','sm15'])"
            style="width:160px;float: left;">
          <br><br>
          <span class="text3">
            <br><br>
            <br><br>
            <b data-i18n="welcome.title" style="font-size: 24px; color: red;">⚠️ Important Notice ⚠️</b>
            <br><br>
            <span data-i18n="welcome.message" style="font-size: 18px; font-weight: bold; color: red;">
              The website is closed. Please use
            </span>
            <span style="font-size: 18px; font-weight: bold; color: red;">
              <a href="https://m3-service.net" target="_blank"
                style="color: blue; text-decoration: underline;">m3-service.net</a>.
            </span>
            <br><br>
            <span data-i18n="welcome.note" style="font-size: 12px; color: gray;">
              P.S. You can use the form to print a PDF if the main website goes down.
            </span>
            <br><br><br>
            <br><br><br>
            <span data-i18n="welcome.process">
              The process is simple: send your M3 Mobile device to the following address:
            </span>
          </span>

          <!-- Address section with data-i18n attributes -->
          <div
            style="margin: 15px; margin-right: max(calc((100% - 450px)/10),0px);float:right; padding: 20px; user-select:text;">
            <small><span class="text3" data-i18n="address.recipient">Recipient</span></small><br>

            <span class="text5" style="color: #1e2071ee;">
              <b>M3 Mobile GmbH</b><br>
              Am Holzweg 26<br>
              65830 Kriftel<br>
              Germany<br>
              <i data-i18n="address.reseller_note">[Name of the Reseller]</i>
            </span>
          </div>

          <span class="text3">
            <br><br><br>
            <br class="disappear555"><br class="disappear555"><br class="disappear555"><br class="disappear555"><br
              class="disappear555"><br class="disappear555"><br class="disappear555">
            <span data-i18n="welcome.contract_info">
              By sending the package, a repair contract is established between you (the sender) and us (the
              recipient).
              You cover the shipping costs to us, and we cover the return shipping costs. Inspection and cost
              estimation are
              free of charge.
            </span><br>
            <span data-i18n="welcome.error_description">
              Please provide a detailed error description, as this significantly increases the chances of a successful
              repair.
            </span><br><br>
            <b data-i18n="welcome.important_note">Important Note:</b><br>
            <span data-i18n="welcome.warranty_info">
              If you have a warranty claim or a service pack agreement, please include the name of the reseller.
            </span><br><br>
          </span>

          <div style="margin: 15px; margin-left: max(calc((100% - 450px)/10),0px);float:left; padding: 18px;">
            <small><span class="text3" data-i18n="address.sender">Sender</span></small><br>
            <span class="text5" style="color: rgb(0, 0, 0, 0.7);">
              <span data-i18n="address.example_company">Example Company</span><br>
              <i data-i18n="address.example_person">[Attn. Max Mustermann]</i><br>
              <span data-i18n="address.example_street">Example Street 42</span><br>
              <span data-i18n="address.example_city">08150 Example City</span><br>
              <i data-i18n="address.example_phone">[+49 00 000000]</i><br>
              <span data-i18n="address.example_email">example@eck3.com</span>
            </span>
          </div>

          <br><br><br>
          <br class="disappear555"><br class="disappear555"><br class="disappear555">
          <br class="disappear555"><br class="disappear555"><br class="disappear555">
          <br class="disappear555">

          <span class="text3">
            <span data-i18n="rma.process_info">
              Once we receive your package, the contract is concluded. We assign your package an RMA number and create
              a
              dedicated page for it. You can access this page by entering the tracking number provided by your
              shipping
              service on our homepage in the corresponding field (yellow label).
            </span><br><br>
            <span data-i18n="rma.tracking_info">
              On this page, you can check your shipment's contents, track the repair status, and update payment
              details or address other issues if necessary. Login details will also be sent to the email address you
              provided on the package.
            </span><br><br><br>
            <span data-i18n="rma.form_info">
              To make sure nothing is forgotten, we have created an RMA form. If you fill out this form and include it
              with your package, we receive all the necessary information in advance and can reduce processing time
              during
              package intake. Thank you for your cooperation!
            </span>
          </span>
          <br>

          <div id="rmaButton" class="buttonFlat"
            onclick="myFetch('rmaGenerate', 'rmaButton', 'output2','','/rma/generate')"
            style="margin: 5px; margin-right: max(calc((100% - 450px)/10),0px);float:right;"
            data-i18n="rma.request_button">
            RMA Repair Request
          </div>
          <br><br><br><br><br><br><br>
        </div>
      </div>
      <div id="tableCell2Over1000px_block" style="vertical-align: top;">
        <br>
        <div class="sticker" id="inputConsole">
          <svg width="60" height="70" xmlns="http://www.w3.org/2000/svg"
            style="display: block; margin-left: auto; margin-right: auto;">
            <use id="lang6" href="#pin" />
          </svg>
          <br>
          <span id="snInputTextUp" class="text2blue" data-i18n="rma.status_check">
            To check the repair status, please enter our RMA number or the device serial number.
          </span>
          <br><br>
          <form>
            <input id="snInput" class="textM3" placeholder="RMA or S/N _ _ _ _ _ _ _" autocomplete="off" type="text"
              inputmode="text" />
          </form>
          <span id="snInputTextDown" class="textM3"></span>
          <br><br>
        </div>
        <br>

        <div class="sticker">
          <svg width="60" height="70" xmlns="http://www.w3.org/2000/svg"
            style="display: block; margin-left: auto; margin-right: auto;">
            <use id="lang6" href="#pin" />
          </svg>
          <span class="text2blue">
            <span data-i18n="service.title">Our Service Centers:</span><br><br>
            <span>Germany</span><br>
            <ul><a href="https://m3.repair/">M3 Mobile GmbH</a></ul><br>
            <br>
            <span>France</span><br>
            <ul><a href="https://www.prestinfo.eu/">Prestinfo Maintenance SAS</a></ul>
            <br>
          </span>
          <br><br>
        </div>
        <br>
        <div class="sticker">
          <svg width="60" height="70" xmlns="http://www.w3.org/2000/svg"
            style="display: block; margin-left: auto; margin-right: auto;">
            <use id="lang6" href="#pin" />
          </svg>
          <span class="text2blue">
            <span data-i18n="links.title">Useful Links:</span><br>
            <br>
            <ul><a href="https://m3mobile-manual.refined.site/space/M3APPMANUAL" target="_blank"
                data-i18n="links.app_manual">M3 Application Manual Guide</a></ul><br>
            <ul><a href="https://m3mobile-manual.refined.site/space/OSRN" target="_blank"
                data-i18n="links.release_notes">OS Release Notes</a></ul><br>
            <ul><a href="https://itc.m3mobile.net/" data-i18n="links.technical_support">Technical Support</a></ul><br>
            <ul><a href="http://partner.m3mobile.net/member/#!/login" data-i18n="links.partner_portal">Partner
                Portal</a></ul><br>
            <ul><a href="https://www.m3mobile.co.kr/en/main" data-i18n="links.homepage">M3 Mobile Homepage</a></ul>
            <br>
          </span>
        </div>
      </div>
    </div>

    <span style="margin: 30px; color: #fff;" data-i18n="footer.copyright">
      Copyright © 2024 M3 Mobile GmbH. All rights reserved.
      Terms & Conditions · Privacy Policy · Legal Notice
    </span>
  </div>





  <!-- END of CONTENT -->


  
  <!-- Diagnostic Tools for i18n - Only shown in development mode -->
  <script>
      // Only create debug panel in development mode
      (function () {
        if (window.APP_CONFIG && window.APP_CONFIG.NODE_ENV === 'development') {
          // Create debug panel 
          const debugPanel = document.createElement('div');
          debugPanel.id = 'i18n-debug';
          debugPanel.style.position = 'fixed';
          debugPanel.style.bottom = '10px';
          debugPanel.style.right = '10px';
          debugPanel.style.zIndex = '1000';
          debugPanel.style.background = 'rgba(0,0,0,0.7)';
          debugPanel.style.color = 'white';
          debugPanel.style.padding = '10px';
          debugPanel.style.borderRadius = '5px';
          debugPanel.style.fontSize = '12px';
          debugPanel.style.display = 'none';

          debugPanel.innerHTML = `
        <h4>i18n Debug (DEV ONLY)</h4>
        <button onclick="window.i18n && window.i18n.checkTranslationFiles()">Check Translation Files</button>
        <button onclick="document.getElementById('i18n-debug').style.display='none'">Close</button>
        <div>
          <label for="debug-lang">Test Language:</label>
          <select id="debug-lang">
            <option value="de">German (de)</option>
            <option value="ru">Russian (ru)</option>
            <option value="ko">Korean (ko)</option>
          </select>
          <button onclick="window.i18n && window.i18n.changeLanguage(document.getElementById('debug-lang').value)">Switch</button>
        </div>
      `;

          // Add to DOM after document is ready
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
              document.body.appendChild(debugPanel);
            });
          } else {
            document.body.appendChild(debugPanel);
          }

          // Add keyboard shortcut
          document.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
              if (debugPanel) {
                debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
              }
            }
          });

          console.log("Dev tools activated - press Ctrl+Shift+I to toggle i18n debug panel");
        }
      })();
  </script>
  <!-- Add i18n script right before the closing body tag  -->

</body>

</html>