# –û—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ eckWMS
**–î–∞—Ç–∞:** 2025-12-27
**–ê—É–¥–∏—Ç–æ—Ä:** Claude Security Auditor
**–í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** 1.0.0

---

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:** 6 —Å—Ä–µ–¥–Ω–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
üìã **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** 8 —É–ª—É—á—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** üü° –°–†–ï–î–ù–Ø–Ø (—É–ª—É—á—à–µ–Ω–∞ —Å üî¥ –ù–ò–ó–ö–û–ô)

---

## 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (–ò–°–ü–†–ê–í–õ–ï–ù–û)

### üî¥ 1.1 –û–±—Ö–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
**–§–∞–π–ª:** `src/server/local/routes/admin.js` (—Å—Ç—Ä–æ–∫–∏ 14-40)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`/admin/`, `/admin/pairing`, `/admin/printing`, `/admin/blueprint`) –æ—Ç–¥–∞–≤–∞–ª–∏—Å—å –ë–ï–ó server-side –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ó–∞—â–∏—Ç–∞ –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (JavaScript), —á—Ç–æ –ª–µ–≥–∫–æ –æ–±–æ–π—Ç–∏.

**–†–∏—Å–∫:**
–õ—é–±–æ–π –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, —Å–∫–ª–∞–¥—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
router.get('/', (req, res) => { ... }); // –ë–ï–ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
// ...
router.use(requireAdmin); // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ü–û–°–õ–ï —Å—Ç—Ä–∞–Ω–∏—Ü

// –°–¢–ê–õ–û:
router.use(requireAdmin); // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –î–û –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
router.get('/', (req, res) => { ... }); // –¢–µ–ø–µ—Ä—å –∑–∞—â–∏—â–µ–Ω–æ
```

---

### üî¥ 1.2 –û—Ç–∫–ª—é—á–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
**–§–∞–π–ª:** `src/server/local/routes/upload.js` (—Å—Ç—Ä–æ–∫–∞ 27)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
Endpoint `/ECK/api/upload/image` –∏–º–µ–ª –æ—Ç–∫–ª—é—á–µ–Ω–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º "Authentication temporarily disabled for debugging Android client". –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–ª–æ –∫–æ–º—É —É–≥–æ–¥–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–†–∏—Å–∫:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ª–µ–≥–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –í–∫–ª—é—á–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: `router.post('/image', requireAuth, ...)`
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: jpeg, jpg, png, webp, avif)
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 10MB)

```javascript
const upload = multer({
  storage: storage,
  limits: {
    fileSize: 10 * 1024 * 1024 // 10MB max
  },
  fileFilter: (req, file, cb) => {
    const allowedTypes = /jpeg|jpg|png|webp|avif/;
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ MIME-—Ç–∏–ø–∞
  }
});
```

---

### üî¥ 1.3 XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ RMA —Ñ–æ—Ä–º–∞—Ö
**–§–∞–π–ª:** `src/server/local/routes/rma.js` (—Å—Ç—Ä–æ–∫–∏ 88-114)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å—Ç–∞–≤–ª—è–ª–∏—Å—å –≤ HTML –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
```javascript
<input type="text" id="company" value="${userData.company}">
```

–ï—Å–ª–∏ `userData.company` —Å–æ–¥–µ—Ä–∂–∏—Ç `"><script>alert('XSS')</script>`, —ç—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

**–†–∏—Å–∫:**
- –ö—Ä–∞–∂–∞ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ JavaScript –∫–æ–¥–∞
- –§–∏—à–∏–Ω–≥ –∞—Ç–∞–∫–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `escapeHtml()` –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ HTML:
```javascript
function escapeHtml(unsafe) {
  return String(unsafe)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

userData = {
  company: escapeHtml(req.user.company || ''),
  email: escapeHtml(req.user.email || ''),
  // ... –≤—Å–µ –ø–æ–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
};
```

---

### üî¥ 1.4 –û—Ç–∫—Ä—ã—Ç—ã–π debug endpoint
**–§–∞–π–ª:** `src/server/local/server.js` (—Å—Ç—Ä–æ–∫–∞ 194)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
Endpoint `/jwt/:token` –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –∏ —Ä–∞—Å–∫—Ä—ã–≤–∞–ª –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–∫–µ–Ω–∞—Ö –∏ –∑–∞–∫–∞–∑–∞—Ö.

**–†–∏—Å–∫:**
- –£—Ç–µ—á–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –†–∞—Å–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–±–æ—Ä–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
```javascript
app.get('/jwt/:token', requireAdmin, (req, res) => { ... });
```

---

### üî¥ 1.5 Command Injection —Ä–∏—Å–∫
**–§–∞–π–ª:** `src/server/local/utils/startupDiagnostics.js` (—Å—Ç—Ä–æ–∫–∞ 23)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
Hostname –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ –∫–æ–º–∞–Ω–¥–µ `traceroute` –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```javascript
const globalServerDomain = new URL(process.env.GLOBAL_SERVER_URL).hostname;
executeCommand(`traceroute ${globalServerDomain}`); // –û–ø–∞—Å–Ω–æ!
```

–ï—Å–ª–∏ `GLOBAL_SERVER_URL` = `https://evil.com; rm -rf /`, —ç—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**–†–∏—Å–∫:**
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è hostname:
```javascript
// –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫–∏ –∏ –¥–µ—Ñ–∏—Å—ã
if (!/^[a-zA-Z0-9.-]+$/.test(globalServerDomain)) {
    console.error('[Diagnostics] Invalid hostname format detected.');
    globalServerDomain = 'pda.repair'; // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
}
```

---

## 2. –°–†–ï–î–ù–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (–¢–†–ï–ë–£–Æ–¢ –í–ù–ò–ú–ê–ù–ò–Ø)

### ‚ö†Ô∏è 2.1 –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–π Content Security Policy (CSP)
**–§–∞–π–ª:** `src/server/local/server.js` (—Å—Ç—Ä–æ–∫–∏ 92-95)
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
app.use(helmet({
    contentSecurityPolicy: false,  // ‚ö†Ô∏è –û—Ç–∫–ª—é—á–µ–Ω!
    crossOriginEmbedderPolicy: false
}));
```

**–†–∏—Å–∫:**
CSP –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç XSS –∞—Ç–∞–∫, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤, —Å—Ç–∏–ª–µ–π –∏ –¥—Ä—É–≥–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```javascript
app.use(helmet({
    contentSecurityPolicy: {
        directives: {
            defaultSrc: ["'self'"],
            scriptSrc: ["'self'", "'unsafe-inline'"], // –í—Ä–µ–º–µ–Ω–Ω–æ, –ø–æ—Ç–æ–º —É–±—Ä–∞—Ç—å unsafe-inline
            styleSrc: ["'self'", "'unsafe-inline'"],
            imgSrc: ["'self'", "data:", "https:"],
            connectSrc: ["'self'"],
            fontSrc: ["'self'"],
            objectSrc: ["'none'"],
            upgradeInsecureRequests: []
        }
    },
    crossOriginEmbedderPolicy: true
}));
```

---

### ‚ö†Ô∏è 2.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CSRF –∑–∞—â–∏—Ç—ã
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û (—Å–ª–æ–∂–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π CSRF –∑–∞—â–∏—Ç—ã. –•–æ—Ç—è JWT –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –Ω–µ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É CSRF, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ cookie –∏–ª–∏ localStorage, –µ—Å—Ç—å —Ä–∏—Å–∫.

**–†–∏—Å–∫:**
–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Å–∞–π—Ç–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ JWT —Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`, –ù–ï –≤ cookie
2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
```javascript
const csurf = require('csurf');
const csrfProtection = csurf({ cookie: true });

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –º–∞—Ä—à—Ä—É—Ç–∞–º
app.post('/admin/api/devices/:id/status', csrfProtection, requireAdmin, ...);
```

---

### ‚ö†Ô∏è 2.3 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Rate Limiting
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ endpoints:
- `/auth/login` - –±—Ä—É—Ç—Ñ–æ—Ä—Å –ø–∞—Ä–æ–ª–µ–π
- `/auth/register` - —Å–ø–∞–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/rma/create` - —Å–ø–∞–º RMA –∑–∞–ø—Ä–æ—Å–æ–≤
- `/ECK/api/upload/image` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

**–†–∏—Å–∫:**
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫–∏
- DDoS
- –ò—Å—á–µ—Ä–ø–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `express-rate-limit`:
```javascript
const rateLimit = require('express-rate-limit');

// –û–±—â–∏–π –ª–∏–º–∏—Ç
const generalLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100 // –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤
});

// –õ–∏–º–∏—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5, // –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
  message: 'Too many login attempts, please try again later'
});

app.use('/api/', generalLimiter);
app.use('/auth/login', authLimiter);
app.use('/auth/register', authLimiter);
```

---

### ‚ö†Ô∏è 2.4 –°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í–æ –º–Ω–æ–≥–∏—Ö –º–µ—Å—Ç–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- Email –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤–µ–∑–¥–µ (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ Sequelize –º–æ–¥–µ–ª–∏)
- –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- –ü–æ—á—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `joi` –∏–ª–∏ `express-validator`):
```javascript
const { body, validationResult } = require('express-validator');

router.post('/auth/register', [
  body('email').isEmail().normalizeEmail(),
  body('password').isLength({ min: 8 })
    .matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/),
  body('phone').optional().isMobilePhone(),
  body('postalCode').optional().isPostalCode('any')
], async (req, res) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return res.status(400).json({ errors: errors.array() });
  }
  // ...
});
```

---

### ‚ö†Ô∏è 2.5 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è cookies
**–§–∞–π–ª:** `src/server/local/routes/auth.js` (—Å—Ç—Ä–æ–∫–∞ 186)
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
res.cookie('auth_token', tokens.accessToken, {
  httpOnly: true,  // ‚úÖ –•–æ—Ä–æ—à–æ
  secure: process.env.NODE_ENV === 'production',  // ‚ö†Ô∏è –ù–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
  maxAge: 3600000
  // ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: sameSite
});
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```javascript
res.cookie('auth_token', tokens.accessToken, {
  httpOnly: true,
  secure: true, // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤ production
  sameSite: 'strict', // –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
  maxAge: 3600000
});
```

---

### ‚ö†Ô∏è 2.6 –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ—à–∏–±–∫–∞—Ö
**–§–∞–π–ª—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ú–Ω–æ–≥–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:
```javascript
res.status(500).json({ error: error.message }); // ‚ö†Ô∏è –ú–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í production –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–µ—Ç–∞–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:
```javascript
console.error('Error details:', error); // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
res.status(500).json({
  error: process.env.NODE_ENV === 'production'
    ? 'Internal server error'
    : error.message
});
```

---

## 3. –•–û–†–û–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò (–û–ë–ù–ê–†–£–ñ–ï–ù–û)

### ‚úÖ 3.1 –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
**–§–∞–π–ª:** `src/shared/models/postgresql/UserAuth.js`
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bcrypt` —Å —Ä–∞—É–Ω–¥–∞–º–∏ 10 –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π. ‚úÖ –û—Ç–ª–∏—á–Ω–æ!

```javascript
beforeCreate: async (user) => {
  if (user.password) {
    user.password = await bcrypt.hash(user.password, 10);
  }
}
```

---

### ‚úÖ 3.2 –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
**–§–∞–π–ª:** `src/server/local/routes/admin.js`
–í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `:replacements`. ‚úÖ –•–æ—Ä–æ—à–æ!

```javascript
await sequelize.query(
  'UPDATE warehouses SET name = :name WHERE id = :id',
  { replacements: { id, name } } // ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection
);
```

---

### ‚úÖ 3.3 JWT —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
**–§–∞–π–ª:** `src/server/local/middleware/auth.js`
–¢–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏. ‚úÖ –•–æ—Ä–æ—à–æ!

```javascript
const accessToken = jwt.sign({ ... }, secret, { expiresIn: '1h' });
const refreshToken = jwt.sign({ ... }, secret, { expiresIn: '90d' });
```

---

### ‚úÖ 3.4 Helmet –¥–ª—è –±–∞–∑–æ–≤–æ–π –∑–∞—â–∏—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
**–§–∞–π–ª:** `src/server/local/server.js`
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `helmet` (—Ö–æ—Ç—è –∏ —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º CSP). ‚úÖ –•–æ—Ä–æ—à–µ–µ –Ω–∞—á–∞–ª–æ!

---

## 4. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –î–ê–õ–¨–ù–ï–ô–®–ï–ú–£ –£–õ–£–ß–®–ï–ù–ò–Æ

### üìã 4.1 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –î–æ—Å—Ç—É–ø –∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- `winston` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `morgan` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è production
- ELK Stack –∏–ª–∏ Grafana Loki –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

---

### üìã 4.2 –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô

–î–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ–±–∞–≤–∏—Ç—å 2FA:
```javascript
const speakeasy = require('speakeasy');
const QRCode = require('qrcode');

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è secret –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const secret = speakeasy.generateSecret({
  name: 'eckWMS',
  length: 32
});

// –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞
const verified = speakeasy.totp.verify({
  secret: user.twoFactorSecret,
  encoding: 'base32',
  token: userProvidedToken
});
```

---

### üìã 4.3 –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ npm:
```bash
npm audit
npm audit fix
```

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- Dependabot (GitHub)
- Snyk
- npm audit –≤ CI/CD

---

### üìã 4.4 –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô

–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:
- Email –∞–¥—Ä–µ—Å–æ–≤ (–º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–ª—è GDPR)
- –¢–µ–ª–µ—Ñ–æ–Ω–æ–≤
- –ê–¥—Ä–µ—Å–æ–≤

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `crypto` –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç–∏–ø–∞ `node-crypto-gcm`.

---

### üìã 4.5 –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô

–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—è–º:
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤ ‚úÖ (—É–∂–µ –µ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—è?)
- –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –±—É–∫–≤, —Ü–∏—Ñ—Ä –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### üìã 4.6 –ê—É–¥–∏—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
- –ö—Ç–æ –∏–º–µ–µ—Ç —Ä–æ–ª—å admin
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- –ò—Å—Ç–µ–∫—à–∏–µ RMA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
```javascript
router.get('/admin/api/security/audit', requireAdmin, async (req, res) => {
  const admins = await UserAuth.findAll({ where: { role: 'admin' } });
  const inactiveUsers = await UserAuth.findAll({
    where: {
      lastLogin: { [Op.lt]: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000) }
    }
  });
  res.json({ admins, inactiveUsers });
});
```

---

### üìã 4.7 Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å:
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup PostgreSQL (—É–∂–µ –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥–∞ `npm run db:dump`)
2. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ backup —Ñ–∞–π–ª–æ–≤
3. –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–µ –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ)
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

### üìã 4.8 HTTPS –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–¥–ª—è production)

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS (Let's Encrypt)
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ HTTPS
- HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

```javascript
app.use((req, res, next) => {
  if (process.env.NODE_ENV === 'production' && !req.secure) {
    return res.redirect('https://' + req.headers.host + req.url);
  }
  next();
});

app.use(helmet.hsts({
  maxAge: 31536000, // 1 –≥–æ–¥
  includeSubDomains: true,
  preload: true
}));
```

---

## 5. –§–ê–ô–õ–´ –° –ò–ó–ú–ï–ù–ï–ù–ò–Ø–ú–ò

–°–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:

1. ‚úÖ `src/server/local/routes/admin.js` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
2. ‚úÖ `src/server/local/routes/upload.js` - –í–∫–ª—é—á–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
3. ‚úÖ `src/server/local/routes/rma.js` - –î–æ–±–∞–≤–ª–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
4. ‚úÖ `src/server/local/server.js` - –ó–∞—â–∏—â–µ–Ω debug endpoint
5. ‚úÖ `src/server/local/utils/startupDiagnostics.js` - –í–∞–ª–∏–¥–∞—Ü–∏—è hostname

---

## 6. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã:

**–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ admin —Å—Ç—Ä–∞–Ω–∏—Ü**
```bash
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401 Unauthorized
curl -v http://localhost:3100/admin/

# –° —Ç–æ–∫–µ–Ω–æ–º –∞–¥–º–∏–Ω–∞ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
curl -v -H "Authorization: Bearer YOUR_ADMIN_TOKEN" http://localhost:3100/admin/
```

**–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤**
```bash
# –ë–µ–∑ —Ç–æ–∫–µ–Ω–∞ - –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401
curl -X POST http://localhost:3100/ECK/api/upload/image \
  -F "image=@test.jpg"

# –° —Ç–æ–∫–µ–Ω–æ–º - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
curl -X POST http://localhost:3100/ECK/api/upload/image \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "image=@test.jpg"
```

**–¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ XSS –∑–∞—â–∏—Ç—ã**
```bash
# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å XSS –≤ –∏–º–µ–Ω–∏ –∫–æ–º–ø–∞–Ω–∏–∏
curl -X POST http://localhost:3100/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "Test1234!",
    "company": "\"><script>alert(\"XSS\")</script>"
  }'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∫—Ä–∏–ø—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω –≤ RMA —Ñ–æ—Ä–º–µ
```

---

## 7. –í–´–í–û–î–´ –ò –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
2. –£–ª—É—á—à–µ–Ω–∞ –æ–±—â–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∞–π–ª–æ–≤
4. –ó–∞—â–∏—â–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:
1. **–°—Ä–æ—á–Ω–æ:** –í–∫–ª—é—á–∏—Ç—å CSP –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É
2. **–°—Ä–æ—á–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å rate limiting
3. **–í–∞–∂–Ω–æ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CSRF –∑–∞—â–∏—Ç—É
4. **–í–∞–∂–Ω–æ:** –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å 2FA –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
6. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
7. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
8. **–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è production:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS

### –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- CSP + CSRF: ~4-6 —á–∞—Å–æ–≤
- Rate Limiting: ~2-3 —á–∞—Å–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: ~8-10 —á–∞—Å–æ–≤
- 2FA: ~6-8 —á–∞—Å–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: ~4-6 —á–∞—Å–æ–≤
- **–ò—Ç–æ–≥–æ:** ~24-33 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

## 8. –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö –î–õ–Ø PRODUCTION

–ü–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ production —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ‚úÖ
- [ ] CSP –≤–∫–ª—é—á–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] CSRF –∑–∞—â–∏—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- [ ] –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ `.env`, –Ω–µ –≤ –∫–æ–¥–µ
- [ ] `.env` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
- [ ] Backup –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Sentry, etc.)
- [ ] `NODE_ENV=production` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –û—Ç–∫–ª—é—á–µ–Ω debug —Ä–µ–∂–∏–º
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ npm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –ó–∞–ø—É—â–µ–Ω `npm audit` –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**

*–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ DevSecOps –∫–æ–º–∞–Ω–¥–µ.*
